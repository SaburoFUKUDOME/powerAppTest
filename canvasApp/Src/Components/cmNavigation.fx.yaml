cmNavigation As CanvasComponent:
    setQuestionValue(qId As Number):
        qId:
            Default: =100
        ThisProperty:
            Default: |-
                =Set(
                    navigationKey,
                    qId
                );
                Set(
                    questionKey,
                    qId
                );
                With({getAnswerRecord:LookUp('仮説構築支援ツール - 回答',And(themeID=themeId,questionID=questionKey))},
                Reset(textAnswer);
                Reset(skipAnswerCheckbox);
                Reset(noAnswerCheckbox);
                Set(
                    currentAnswer,
                    If(IsBlank(getAnswerRecord),"",getAnswerRecord.answer)
                    );
                Set(
                    skipFlag,
                    getAnswerRecord.skip_flag
                    );
                Set(
                    noAnswerFlag,
                    getAnswerRecord.no_answer_flag
                    );
                );
                
                With({qRecord:LookUp(questionList, ID=questionKey)},
                Set(
                    currentTitle,
                    qRecord.Title
                );
                Set(
                    currentQuestion,
                    qRecord.question_content
                );
                Set(currentCategory,qRecord.category);
                Set(
                    controlType,
                    qRecord.control_type
                );
                Set(
                    currentPage,
                    qRecord.current_question_number
                );
                Set(
                    totalPage,
                    qRecord.question_totalnumber
                );
                Set(
                    commentary,
                    qRecord.commentary
                );
                Set(
                    example,
                    qRecord.example
                );
                Set(
                    currentRequired,
                    qRecord.required
                );
                Set(
                    nextVisible,
                    If(qRecord.next_question_id=0,false,true)
                
                );
                Set(
                    confirmVisible,
                    If(qRecord.next_question_id=0,true,false)
                );
                );
                Set(
                    backVisible,
                    false
                );
                Set(
                    commentaryGroupVisible,
                    true
                );
                Set(
                    exampleGroupVisible,
                    false
                );
                If(Not(currentRequired="2"),Set(currentQuestion,Concatenate(currentQuestion,"*")))
    Fill: =RGBA(0, 0, 0, 0)
    Height: =500
    updateAnswer: |-
        =If(
            controlType = "text",
            Set(
                answerContent,
                textAnswer.Text
            ),
            Set(
                answerContent,
                Radio1.Selected.Result
            )
        );
        With(
            {
                getAnswerRecord: LookUp(
                    '仮説構築支援ツール - 回答',
                    And(
                        themeID = themeId,
                        questionID = questionKey
                    )
                )
            },
            If(
                Not(
                    And(
                        answerContent = currentAnswer,
                        skipFlag = skipAnswerCheckbox.Value,
                        noAnswerFlag = noAnswerCheckbox.Value
                    )
                ),
                If(
                    IsBlank(getAnswerRecord),
                    Patch(
                        '仮説構築支援ツール - 回答',
                        Defaults('仮説構築支援ツール - 回答'),
                        {
                            themeID: themeId,
                            questionID: questionKey,
                            category: currentCategory,
                            answer: answerContent,
                            skip_flag: skipAnswerCheckbox.Value,
                            no_answer_flag: noAnswerCheckbox.Value,
                            status: If(
                                skipAnswerCheckbox.Value,
                                2,
                                !IsBlank(answerContent),
                                10,
                                And(
                                    currentRequired = "2",
                                    noAnswerCheckbox.Value
                                ),
                                10,
                                0
                            )
                        }
                    );
                    ,
                    Patch(
                        '仮説構築支援ツール - 回答',
                        getAnswerRecord,
                        {
                            answer: answerContent,
                            skip_flag: skipAnswerCheckbox.Value,
                            no_answer_flag: noAnswerCheckbox.Value,
                            status: If(
                                skipAnswerCheckbox.Value,
                                2,
                                !IsBlank(answerContent),
                                10,
                                And(
                                    currentRequired = "2",
                                    noAnswerCheckbox.Value
                                ),
                                10,
                                0
                            )
                        }
                    );
                )
            );
        )
    Width: =205
    X: =0
    Y: =0
    ZIndex: =5

    "navigateGallery As gallery.'BrowseLayout_Vertical_TwoTextOneImageVariant_ver4.0'":
        Height: =380
        Items: =navigationList
        Layout: =Layout.Vertical
        TemplateFill: |
            =If(ThisItem.question_id = navigationKey,baseColor,White)
        TemplatePadding: =0
        TemplateSize: =40
        Width: =200
        Y: =92
        ZIndex: =3

        navigateButton As button:
            BorderColor: =baseColor
            Color: =If(ThisItem.question_id = navigationKey,White,baseColor)
            DisabledBorderColor: =baseColor
            Fill: =RGBA(0, 0, 0, 0)
            Height: =navigateGallery.TemplateHeight
            HoverFill: =baseColor
            OnSelect: |
                =//問画面の場合のみ、答えを更新する
                If(pageKey ="question",cmNavigation.updateAnswer(),Navigate(
                    scrennQuestion,
                    ScreenTransition.Fade
                );); 
                cmNavigation.setQuestionValue(ThisItem.question_id);
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =12
            Text: =ThisItem.Title
            Width: =navigateGallery.TemplateWidth
            ZIndex: =6

    homeButton As button:
        BorderColor: =baseColor
        BorderThickness: =3
        Color: =baseColor
        DisabledBorderColor: =baseColor
        DisabledColor: =baseColor
        DisabledFill: =baseColor
        Fill: =RGBA(0, 0, 0, 0)
        FontWeight: =FontWeight.Bold
        Height: =46
        HoverFill: =baseColor
        OnSelect: |-
            =cmNavigation.updateAnswer();
            Navigate(screenCanvas,ScreenTransition.Fade)
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Size: =16
        Text: ="Home"
        Visible: =If(pageKey="question",true,false)
        Width: =200
        ZIndex: =4

    homeButtonView As button:
        BorderColor: =baseColor
        BorderThickness: =3
        Color: =White
        DisabledBorderColor: =baseColor
        DisabledColor: =baseColor
        DisabledFill: =baseColor
        DisplayMode: =DisplayMode.View
        Fill: =baseColor
        FontWeight: =FontWeight.Bold
        Height: =46
        HoverFill: =baseColor
        OnSelect: =
        RadiusBottomLeft: =0
        RadiusBottomRight: =0
        RadiusTopLeft: =0
        RadiusTopRight: =0
        Size: =16
        Text: ="Home"
        Visible: =If(pageKey="canvas",true,false)
        Width: =200
        ZIndex: =5

